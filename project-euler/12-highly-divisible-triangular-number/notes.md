# Project Euler Problem 12: Highly Divisible Triangular Number

> https://projecteuler.net/problem=12

> This one kind of stumped me for awhile because I couldn't figure out how to
> reliably implement a function for finding divisors. I was fairly close a
> number of times knowing there was some relation to prime factorization, but
> that definitely held me back.
>
> I explored Wikipedia for some answers, and while it gave me some formulas that
> I was able to implement for a fast solution, I did not understand them right
> from the start.

Starting off with **triangular numbers**. _"The sequence of triangle numbers is
generated by adding the natural numbers. So the $7^{\text{th}}$ triangle number
would be $1+2+3+4+5+6+7=28$."_

Thus, we can say, $T_{n}=\sum _{k=1}^{n}k = \frac {n(n+1)}{2}$

To verify, solve $T_7 = \frac {7(7+1)}{2} = 28$

So now, instead of adding up all numbers $1..n$, requiring $O(n)$ operations, we
can immediately compute the triangular number $T_n$ in $O(1)$ operations.

Next, **divisors**. Not surprisingly, there is a lot to the term. But what we
care about is finding the _number of divisors_ for any given number $n$ (in this
specific problem case, a triangular number, but a natural number nonetheless).
It is stated that any positive divisor of $n$ is a product of prime divisors of
$n$ raised to some power. This is a consequence of the fundamental theorem of
arithmetic. We can demonstrate this fairly simply, given $n=30$, the prime
factorization would be $2^1 \times 3^1 \times 5^1$. Its fairly trivial to work
out the set of divisors for $n=30$.

First, list the products $a \times b = 30$

$$
\begin{aligned}
30 &= 1 \times 30 \\
&= 2 \times 15 \\
&= 3 \times 10 \\
&= 5 \times 6
\end{aligned}
$$

Thus, the set of divisors for $n=30$ is $\{1, 2, 3, 5, 6, 10, 15, 30\}$

Now we can take the original prime factors $\{2, 3, 5\}$ and find all
combinations of them,

$$
\begin{aligned}
2 \times 3 &= 6 \\
2 \times 5 &= 10 \\
3 \times 5 &= 15
\end{aligned}
$$

Include $\{1, n\}$ (the trivial divisors), and we get the equivalent set of
divisors $\{1, 2, 3, 5, 6, 10, 15, 30\}$ comprised of the prime factors, their
products, and the trivial divisors.

In this example, all the prime factors had the same power of $1$, but this also
works when there are powers greater than $1$. Given $n=50$,

$$
\begin{aligned}
50 &= 1 \times 50 \\
&= 2 \times 25 \\
&= 5 \times 10
\end{aligned}
$$

And with prime factors,

$$
\begin{aligned}
50 &= 2^1 \times 5^2 \\
&= \{2,5,5\} \\
& 2 \times 5 = 10 \\
& 5 \times 5 = 25
\end{aligned}
$$

Thus, the set of divisors is $\{1,2,5,10,25,50\}$.

So all in all, we are able to prove that any positive divisor of $n$ is a
product of prime divisors of $n$ raised to some power.

Now this methodology is great for finding the set of divisors, but for this
problem we only care for the number of divisors (or size of the set of
divisors). Wikipedia provides a shortcut, if the prime factorization of $n$ is
$n=p^{v_1}_1 p^{v_2}_2 \dotsb p^{v_k}_k$, then the number of divisors of $n$ is
$d(n)=(v_1 + 1)(v_2 + 1)\dotsb (v_k + 1)$. But where does this come from? It is
based on the combinations of the powers $v_k$ of the prime factors $p_k$ of $n$.
Previously, we proved that any divisor of $n$ is some product of the prime
factors of $n$. Using combinations of the prime factors and the range of their
powers, another way to write the divisors of $n=50=2^1\times5^2$ is to produce
the complete combination set of valid prime factor products. Since we have two
factors $p_1=2$ and $p_2=5$, and powers $v_1=1$ and $v_2=2$ respectively, we can
find all divisors of $n=50$ by working out the set of all combinations of the
powers starting from $0$

$$
\begin{aligned}
(v_1, v_2) &\rightarrow 2^{v_1} \times 5^{v_2} = d \\
(0,0) &\rightarrow 2^0 \times 5^0 = 1 \\
(0,1) &\rightarrow 2^0 \times 5^1 = 5 \\
(0,2) &\rightarrow 2^0 \times 5^2 = 25 \\
(1,0) &\rightarrow 2^1 \times 5^0 = 2 \\
(1,1) &\rightarrow 2^1 \times 5^1 = 10 \\
(1,2) &\rightarrow 2^1 \times 5^2 = 50
\end{aligned}
$$

This can be abstracted to say that the choices of power $v_1$ from $0$ to $v1$
would be $(v_1 + 1)$. Given that we are trying to find _all_ combinations of
these choices, we can thus derive the divisor formula by multiplying the number
of choices for each power of each prime factor together.

And finally, just to prove this all works for $n=50$, plug the powers $1$ and
$2$ into the formula $d(50) = (1+1)(2+1) = (2)(3) = 6$ and it works out
correctly!

So now we can put all of this together to solve the problem. Given formulas
$T_n$, prime factorization, and $d(T_n)$, we can quickly search for the value of
$T_n$ that has $d(T_n) > 500$:

```typescript
// divisor formula
function countDivisors(n) {
	const primeFactors = primeFactor(n);
	let divisors = 1;
	for (const [, power] of primeFactors) {
		divisors *= power + 1;
	}
	return divisors;
}

let n = 1;
while (true) {
	// triangular number formula
	let t = (n * (n + 1)) / 2;

	const f = countDivisors(t);

	if (f > 500) {
		console.log(`n: ${n}, t: ${t}`);
		break;
	}

	n++;
}
```

Wikipedia also listed one more fact about the divisor formula that helps
optimize the solution a bit further $d(n) < 2 \sqrt n$.

> It doesn't really provide any proof for this nor could I figure out how to
> prove it, but it logically tracks enough to assume it is correct for the
> purpose of this trivial problem.

So, adding this slight optimization allows us to skip factorization (the most
expensive part of the solution) for only values that may actually have enough
divisors to matter

```typescript
let n = 1;
while (true) {
	// triangular number formula
	let t = (n * (n + 1)) / 2;

	if (2 * Math.sqrt(t) < 500) {
		n++;
		continue;
	}

	const f = countDivisors(t);

	if (f > 500) {
		console.log(`n: ${n}, t: ${t}`);
		break;
	}

	n++;
}
```

Finally, the answer:

```
n: 12375, t: 76576500
```
